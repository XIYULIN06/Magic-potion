<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>magic-potion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700;900&display=swap');

        body {
            font-family: 'Noto Sans SC', 'Source Han Sans', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            font-weight: 700;
            background: #2c3e50;
            overflow: hidden;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 0;
        }

        .game-container {
            position: relative;
            width: 1344px;
            height: 768px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transform-origin: center;
            overflow: hidden;
        }

        /* å½©è™¹æ¡¥æ ·å¼ */
        .rainbow-bridge {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 600px;
            height: 40px;
            display: flex;
            z-index: 15;
            background: #2c3e50;
            border: 3px solid #34495e;
            border-radius: 20px;
            box-shadow: 
                inset 0 2px 4px rgba(0,0,0,0.3),
                0 4px 8px rgba(0,0,0,0.2);
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        .rainbow-segment {
            flex: 1;
            height: 100%;
            background: #2c3e50;
            border-right: 2px solid #34495e;
            transition: all 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .rainbow-segment:last-child {
            border-right: none;
        }

        .rainbow-segment.active {
            animation: rainbow-glow 2s ease-in-out;
        }

        .rainbow-segment[data-color="red"].active {
            background: linear-gradient(45deg, #ff0000, #ff4444);
            box-shadow: 
                inset 0 2px 4px rgba(255,255,255,0.3),
                0 0 10px rgba(255,0,0,0.5);
        }

        .rainbow-segment[data-color="orange"].active {
            background: linear-gradient(45deg, #ff8800, #ffaa44);
            box-shadow: 
                inset 0 2px 4px rgba(255,255,255,0.3),
                0 0 10px rgba(255,136,0,0.5);
        }

        .rainbow-segment[data-color="yellow"].active {
            background: linear-gradient(45deg, #ffff00, #ffff44);
            box-shadow: 
                inset 0 2px 4px rgba(255,255,255,0.3),
                0 0 10px rgba(255,255,0,0.5);
        }

        .rainbow-segment[data-color="green"].active {
            background: linear-gradient(45deg, #00ff00, #44ff44);
            box-shadow: 
                inset 0 2px 4px rgba(255,255,255,0.3),
                0 0 10px rgba(0,255,0,0.5);
        }

        .rainbow-segment[data-color="blue"].active {
            background: linear-gradient(45deg, #0088ff, #44aaff);
            box-shadow: 
                inset 0 2px 4px rgba(255,255,255,0.3),
                0 0 10px rgba(0,136,255,0.5);
        }

        .rainbow-segment[data-color="indigo"].active {
            background: linear-gradient(45deg, #4400ff, #6644ff);
            box-shadow: 
                inset 0 2px 4px rgba(255,255,255,0.3),
                0 0 10px rgba(68,0,255,0.5);
        }

        .rainbow-segment[data-color="violet"].active {
            background: linear-gradient(45deg, #8800ff, #aa44ff);
            box-shadow: 
                inset 0 2px 4px rgba(255,255,255,0.3),
                0 0 10px rgba(136,0,255,0.5);
        }

        @keyframes rainbow-glow {
            0% { 
                transform: scale(1);
                filter: brightness(1);
            }
            50% { 
                transform: scale(1.05);
                filter: brightness(1.3);
            }
            100% { 
                transform: scale(1);
                filter: brightness(1);
            }
        }

        /* å½©è™¹æ¡¥å®Œæˆæ—¶çš„ç‰¹æ•ˆ */
        .rainbow-bridge.completed {
            animation: rainbow-complete 3s ease-in-out;
        }

        @keyframes rainbow-complete {
            0% { 
                transform: translateX(-50%) scale(1);
                filter: brightness(1);
            }
            25% { 
                transform: translateX(-50%) scale(1.1);
                filter: brightness(1.5) hue-rotate(0deg);
            }
            50% { 
                transform: translateX(-50%) scale(1.2);
                filter: brightness(2) hue-rotate(180deg);
            }
            75% { 
                transform: translateX(-50%) scale(1.1);
                filter: brightness(1.5) hue-rotate(360deg);
            }
            100% { 
                transform: translateX(-50%) scale(1);
                filter: brightness(1) hue-rotate(0deg);
            }
        }

        .video-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            /* ä¼˜åŒ–è§†é¢‘å¾ªç¯æ’­æ”¾å’Œè¡¥å¸§ */
            transition: opacity 0.1s ease-in-out;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            image-rendering: pixelated;
            /* ç¡¬ä»¶åŠ é€Ÿ */
            transform: translateZ(0);
            will-change: transform;
            /* å¹³æ»‘æ’­æ”¾ */
            backface-visibility: hidden;
            perspective: 1000px;
        }

        .video-background::-webkit-media-controls {
            display: none !important;
        }

         .video-background::-webkit-media-controls-panel {
             display: none !important;
         }

         /* é“å…·æŒ‰é’®åŒºåŸŸ - å·¦ä¸Šè§’ */
         .powerup-container {
             position: absolute;
             top: 20px;
             left: 20px;
             width: 200px;
             height: 60px;
             z-index: 10;
             background: white;
             border-radius: 25px;
             box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
         }

         /* From Uiverse.io by Codecite */
         .powerup-btn {
             --fancy-button-gradient-0: #8d49fd;
             --fancy-button-gradient-50: #7f56f3;
             --fancy-button-gradient-100: #5691f3;
             --fancy-button-inner-shadow-top: rgba(233, 209, 255, 0.2);
             --fancy-button-inner-shadow-top-lg: rgba(9, 12, 60, 0.1);
             --fancy-button-inner-shadow-bottom: rgba(137, 222, 246, 0.3);
             --fancy-button-shine-top: #e9d1ff;
             --fancy-button-shine-bottom: #adfff9;
             font-weight: 700;
             font-size: 15px;
             line-height: 21px;
             text-shadow: 0px 0.5px 0.5px rgba(0, 0, 0, 0.2);
             padding: 0;
             margin: 0;
             appearance: none;
             border: none;
             outline: none;
             overflow: hidden;
             position: relative;
             cursor: pointer;
             z-index: 1;
             border-radius: 25px;
             color: #fff;
             background-image: linear-gradient(
               to bottom,
               var(--fancy-button-gradient-0) 0%,
               var(--fancy-button-gradient-50) 50%,
               var(--fancy-button-gradient-100) 100%
             );
             box-shadow:
               0px 4px 12px rgba(9, 12, 60, 0.15),
               0px 2px 8px rgba(9, 12, 60, 0.15),
               0px 1px 3px var(--fancy-button-inner-shadow-top-lg),
               inset 0px 1px 1px var(--fancy-button-inner-shadow-top),
               inset 0px -1px 3px var(--fancy-button-inner-shadow-bottom);
             width: 100%;
             height: 100%;
             font-family: 'Noto Sans SC', 'Source Han Sans', 'PingFang SC', 'Microsoft YaHei', sans-serif;
             font-weight: 700;
             font-size: 14px;
         }

         .powerup-btn:before,
         .powerup-btn:after {
             content: "";
             position: absolute;
             border-radius: inherit;
             will-change: transform;
         }

         .powerup-btn:before {
             left: 50%;
             transform: translateX(-50%);
             background-color: var(--fancy-button-shine-top);
             width: 96px;
             height: 6px;
             top: -3px;
             opacity: 0.6;
             filter: blur(6px);
             transition: opacity 0.25s;
         }

         .powerup-btn:after {
             inset: 0;
             background-size: cover;
             z-index: 2;
             opacity: 0.3;
             mix-blend-mode: overlay;
             pointer-events: none;
         }

         .powerup-btn span {
             display: block;
             padding: 12px 24px;
             border-radius: inherit;
             overflow: hidden;
             position: relative;
             background-image: linear-gradient(
               to bottom,
               var(--fancy-button-shine-top),
               transparent 8px
             );
             background-position: 0 -6px;
             background-repeat: no-repeat;
             z-index: 1;
         }

         .powerup-btn span:before,
         .powerup-btn span:after {
             content: "";
             position: absolute;
             left: 50%;
             transform: translateX(-50%);
             border-radius: 50%;
             background-color: var(--fancy-button-shine-bottom);
             transition:
               opacity 0.25s,
               transform 0.25s;
             will-change: transform;
         }

         .powerup-btn span:before {
             width: 92px;
             height: 8px;
             bottom: -4px;
             opacity: 0.75;
             filter: blur(6px);
         }

         .powerup-btn span:after {
             width: 112px;
             height: 1px;
             bottom: 0;
             opacity: 0.9;
             filter: blur(1px);
         }

         .powerup-btn:hover span:before {
             opacity: 0.8;
         }

         .powerup-btn:hover span:before {
             transform: translateX(-50%) scale(1.25);
         }

         .powerup-btn:hover span:after {
             opacity: 1;
         }

         .powerup-disabled {
             opacity: 0.5;
             cursor: not-allowed;
         }

         .powerup-disabled:hover {
             background: initial;
             color: initial;
         }

         /* å“åº”å¼é€‚é… - ç­‰æ¯”ç¼©æ”¾ä¸è£å‰ª */
        @media (max-width: 1344px), (max-height: 768px) {
            .game-container {
                transform: scale(min(100vw / 1344, 100vh / 768));
                transform-origin: center center;
            }
        }

        /* ç¡®ä¿æ¸¸æˆå®¹å™¨å§‹ç»ˆå±…ä¸­ä¸”ä¸è¶…å‡ºè§†å£ */
        .game-container {
            flex-shrink: 0;
        }

         /* å€’è®¡æ—¶åŒºåŸŸ - é­”æ³•æŒ‰é’®é£æ ¼ */
         .countdown-container {
             position: absolute;
             top: 20px;
             right: 20px;
             width: 200px;
             height: 60px;
             z-index: 10;
         }

         .countdown-bg {
             --h-button: 60px;
             --w-button: 200px;
             --round: 0.75rem;
             cursor: pointer;
             position: relative;
             display: inline-flex;
             align-items: center;
             justify-content: center;
             overflow: hidden;
             transition: all 0.25s ease;
             background: radial-gradient(
                 65.28% 65.28% at 50% 100%,
                 rgba(223, 113, 255, 0.8) 0%,
                 rgba(223, 113, 255, 0) 100%
               ),
               linear-gradient(0deg, #7a5af8, #7a5af8);
             border-radius: var(--round);
             border: none;
             outline: none;
             padding: 12px 18px;
             width: 100%;
             height: 100%;
         }

         .countdown-bg::before,
         .countdown-bg::after {
             content: "";
             position: absolute;
             inset: var(--space);
             transition: all 0.5s ease-in-out;
             border-radius: calc(var(--round) - var(--space));
             z-index: 0;
         }

         .countdown-bg::before {
             --space: 1px;
             background: linear-gradient(
               177.95deg,
               rgba(255, 255, 255, 0.19) 0%,
               rgba(255, 255, 255, 0) 100%
             );
         }

         .countdown-bg::after {
             --space: 2px;
             background: radial-gradient(
                 65.28% 65.28% at 50% 100%,
                 rgba(223, 113, 255, 0.8) 0%,
                 rgba(223, 113, 255, 0) 100%
               ),
               linear-gradient(0deg, #7a5af8, #7a5af8);
         }

         .countdown-label {
             position: absolute;
             top: 8px;
             left: 15px;
             font-size: 14px;
             color: #fff;
             font-weight: 700;
             font-family: 'Noto Sans SC', 'Source Han Sans', 'PingFang SC', 'Microsoft YaHei', sans-serif;
             font-weight: 700;
             z-index: 2;
         }

         .countdown-display {
             position: absolute;
             top: 50%;
             left: 50%;
             transform: translate(-50%, -50%);
             font-size: 20px;
             font-weight: 700;
             color: #fff;
             font-family: 'Noto Sans SC', 'Source Han Sans', 'PingFang SC', 'Microsoft YaHei', sans-serif;
             font-weight: 700;
             z-index: 2;
         }

         .countdown-display.warning {
             color: #ff9800;
             animation: pulse-warning 1s infinite;
         }

         .countdown-display.danger {
             color: #f44336;
             animation: pulse-danger 0.5s infinite;
         }

         @keyframes pulse-warning {
             0%, 100% { transform: translate(-50%, -50%) scale(1); }
             50% { transform: translate(-50%, -50%) scale(1.1); }
         }

         @keyframes pulse-danger {
             0%, 100% { transform: translate(-50%, -50%) scale(1); }
             50% { transform: translate(-50%, -50%) scale(1.2); }
         }

         /* é‡å¼€æç¤º */
         .restart-hint {
             position: absolute;
             bottom: 20px;
             right: 120px;
             z-index: 10;
             background: rgba(0, 0, 0, 0.8);
             color: #ffd700;
             padding: 8px 16px;
             border-radius: 20px;
             font-size: 14px;
             font-weight: 700;
             font-family: 'Noto Sans SC', 'Source Han Sans', 'PingFang SC', 'Microsoft YaHei', sans-serif;
             text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
             border: 2px solid #ffd700;
             box-shadow: 0 4px 8px rgba(0,0,0,0.3);
             opacity: 0;
             transform: translateX(20px);
             transition: all 0.3s ease;
             pointer-events: none;
         }

         .restart-hint.show {
             opacity: 1;
             transform: translateX(0);
         }

         /* æš‚åœæŒ‰é’® - é­”æ³•æŒ‰é’®é£æ ¼ */
         .pause-container {
             position: absolute;
             bottom: 20px;
             right: 20px;
             z-index: 10;
         }

         /* From Uiverse.io by Codecite */
         .btn {
             --fancy-button-gradient-0: #8d49fd;
             --fancy-button-gradient-50: #7f56f3;
             --fancy-button-gradient-100: #5691f3;
             --fancy-button-inner-shadow-top: rgba(233, 209, 255, 0.2);
             --fancy-button-inner-shadow-top-lg: rgba(9, 12, 60, 0.1);
             --fancy-button-inner-shadow-bottom: rgba(137, 222, 246, 0.3);
             --fancy-button-shine-top: #e9d1ff;
             --fancy-button-shine-bottom: #adfff9;
             font-weight: 700;
             font-size: 15px;
             line-height: 21px;
             text-shadow: 0px 0.5px 0.5px rgba(0, 0, 0, 0.2);
             padding: 0;
             margin: 0;
             appearance: none;
             border: none;
             outline: none;
             overflow: hidden;
             position: relative;
             cursor: pointer;
             z-index: 1;
             border-radius: 25px;
             color: #fff;
             background-image: linear-gradient(
               to bottom,
               var(--fancy-button-gradient-0) 0%,
               var(--fancy-button-gradient-50) 50%,
               var(--fancy-button-gradient-100) 100%
             );
             box-shadow:
               0px 4px 12px rgba(9, 12, 60, 0.15),
               0px 2px 8px rgba(9, 12, 60, 0.15),
               0px 1px 3px var(--fancy-button-inner-shadow-top-lg),
               inset 0px 1px 1px var(--fancy-button-inner-shadow-top),
               inset 0px -1px 3px var(--fancy-button-inner-shadow-bottom);
         }

         .btn:before,
         .btn:after {
             content: "";
             position: absolute;
             border-radius: inherit;
             will-change: transform;
         }

         .btn:before {
             left: 50%;
             transform: translateX(-50%);
             background-color: var(--fancy-button-shine-top);
             width: 96px;
             height: 6px;
             top: -3px;
             opacity: 0.6;
             filter: blur(6px);
             transition: opacity 0.25s;
         }

         .btn:after {
             inset: 0;
             background-size: cover;
             z-index: 2;
             opacity: 0.3;
             mix-blend-mode: overlay;
             pointer-events: none;
         }

         .btn span {
             display: block;
             padding: 12px 24px;
             border-radius: inherit;
             overflow: hidden;
             position: relative;
             background-image: linear-gradient(
               to bottom,
               var(--fancy-button-shine-top),
               transparent 8px
             );
             background-position: 0 -6px;
             background-repeat: no-repeat;
             z-index: 1;
         }

         .btn span:before,
         .btn span:after {
             content: "";
             position: absolute;
             left: 50%;
             transform: translateX(-50%);
             border-radius: 50%;
             background-color: var(--fancy-button-shine-bottom);
             transition:
               opacity 0.25s,
               transform 0.25s;
             will-change: transform;
         }

         .btn span:before {
             width: 92px;
             height: 8px;
             bottom: -4px;
             opacity: 0.75;
             filter: blur(6px);
         }

         .btn span:after {
             width: 112px;
             height: 1px;
             bottom: 0;
             opacity: 0.9;
             filter: blur(1px);
         }

         .btn:hover span:before {
             opacity: 0.8;
         }

         .btn:hover span:before {
             transform: translateX(-50%) scale(1.25);
         }

         .btn:hover span:after {
             opacity: 1;
         }

        /* æ¸¸æˆæŒ‡å— - ç§»åŠ¨åˆ°è“æ¡†ä½ç½® */
        .game-guide {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: #34495e;
            color: #ecf0f1;
            padding: 20px;
            border: 4px solid #2c3e50;
            border-radius: 12px;
            width: 350px;
            z-index: 10;
            box-shadow: 
                inset 3px 3px 0 #7f8c8d,
                inset -3px -3px 0 #2c3e50,
                0 6px 12px rgba(0,0,0,0.4);
        }

        .game-guide h3 {
            margin-bottom: 15px;
            font-size: 18px;
            color: #f39c12;
            text-shadow: 2px 2px 0 #2c3e50;
            font-weight: 700;
            text-align: center;
        }

        .game-guide ol {
            margin-left: 0;
            padding-left: 0;
            list-style: none;
        }

        .game-guide li {
            margin-bottom: 12px;
            font-size: 16px;
            line-height: 1.6;
            text-shadow: 2px 2px 0 #2c3e50;
            font-weight: 700;
            padding: 8px 12px;
            background: rgba(52, 73, 94, 0.5);
            border-radius: 6px;
            border-left: 4px solid #f39c12;
        }

         /* ç“¶å­å®¹å™¨ - ç§»åŠ¨åˆ°æ¡Œå­ä¸Š */
         .bottles-container {
             position: absolute;
             bottom: 20px;
             left: 50%;
             transform: translateX(-50%);
             display: flex;
             gap: 20px;
             align-items: flex-end;
             justify-content: center;
         }

         .bottle {
             position: relative;
             width: 240px;
             height: 360px;
             cursor: pointer;
             transition: all 0.3s ease;
             background: url('img_bottle.png') center/contain no-repeat;
             image-rendering: pixelated;
             image-rendering: -moz-crisp-edges;
             image-rendering: crisp-edges;
         }

        .bottle:hover {
            transform: scale(1.05) translateY(-4px);
        }

         .bottle.selected {
             transform: scale(1.1) translateY(-6px);
             filter: drop-shadow(0 0 20px #ffd700) brightness(1.2);
             animation: magic-pulse 1s infinite;
         }

         @keyframes magic-pulse {
             0% { 
                 filter: drop-shadow(0 0 20px #ffd700) brightness(1.2) hue-rotate(0deg);
             }
             50% { 
                 filter: drop-shadow(0 0 30px #ffd700) brightness(1.3) hue-rotate(20deg);
             }
             100% { 
                 filter: drop-shadow(0 0 20px #ffd700) brightness(1.2) hue-rotate(0deg);
             }
         }

         .bottle-content {
             position: absolute;
             bottom: 40px;
             left: 80px;
             right: 60px;
             top: 100px;
             border-radius: 0 0 12px 12px;
             transition: all 0.5s ease;
             background: transparent;
             overflow: hidden;
         }

        .bottle-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255,255,255,0.6) 20%, 
                rgba(255,255,255,0.8) 50%, 
                rgba(255,255,255,0.6) 80%, 
                transparent 100%);
            border-radius: 0 0 8px 8px;
        }

        .pour-animation {
            animation: pour 0.5s ease-out;
        }

        @keyframes pour {
            0% { transform: scaleY(1); }
            50% { transform: scaleY(0.8); }
            100% { transform: scaleY(1); }
        }

        /* èƒœåˆ©å’Œå¤±è´¥æ¶ˆæ¯ */
        .victory-message, .game-over-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            font-size: 16px;
            font-weight: 700;
            display: none;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            font-family: 'Noto Sans SC', 'Source Han Sans', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            font-weight: 700;
            text-shadow: 2px 2px 0 #000;
        }

        .victory-message {
            color: #4CAF50;
            border: 3px solid #4CAF50;
        }

        .game-over-message {
            color: #f44336;
            border: 3px solid #f44336;
        }

        .next-level-btn, .restart-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 15px;
            border-radius: 8px;
            font-weight: 700;
            transition: background 0.3s ease;
            font-family: 'Noto Sans SC', 'Source Han Sans', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            font-weight: 700;
            text-shadow: 2px 2px 0 #2c3e50;
        }

        .next-level-btn:hover, .restart-btn:hover {
            background: #45a049;
        }

        .restart-btn {
            background: #f44336;
        }

        .restart-btn:hover {
            background: #da190b;
        }

        /* å½©è™¹æ¡¥å®Œæˆæç¤º */
        .rainbow-complete-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ff0000, #ff8800, #ffff00, #00ff00, #0088ff, #4400ff, #8800ff);
            background-size: 400% 400%;
            animation: rainbow-gradient 3s ease infinite;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            display: none;
            z-index: 2000;
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.5),
                inset 0 2px 4px rgba(255,255,255,0.3);
            border: 4px solid #fff;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            font-family: 'Noto Sans SC', 'Source Han Sans', 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }

        .rainbow-complete-message h2 {
            margin-bottom: 20px;
            font-size: 32px;
            animation: text-glow 2s ease-in-out infinite alternate;
        }

        .rainbow-complete-message p {
            margin-bottom: 30px;
            font-size: 18px;
        }

        .rainbow-complete-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 25px;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            font-family: 'Noto Sans SC', 'Source Han Sans', 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }

        .rainbow-complete-btn:hover {
            background: linear-gradient(45deg, #45a049, #4CAF50);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
        }

        /* é­”æ³•è¯æ°´å®¹å™¨ */
        .magic-potion-container {
            margin: 20px 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* é­”æ³•è¯æ°´å›¾ç‰‡ */
        .magic-potion-img {
            width: 120px;
            height: 120px;
            object-fit: contain;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            animation: potion-glow 2s ease-in-out infinite alternate;
            background: transparent;
            border: none;
            outline: none;
            box-shadow: none;
        }


        @keyframes potion-glow {
            0% { 
                filter: brightness(1) drop-shadow(0 0 10px rgba(255,215,0,0.5));
            }
            100% { 
                filter: brightness(1.2) drop-shadow(0 0 20px rgba(255,215,0,0.8)) drop-shadow(0 0 30px rgba(255,107,53,0.6));
            }
        }

        @keyframes potion-shimmer {
            0% { 
                transform: translateX(-50%) translateY(-10px);
                opacity: 0;
            }
            50% { 
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
            100% { 
                transform: translateX(-50%) translateY(10px);
                opacity: 0;
            }
        }

        @keyframes potion-appear {
            0% { 
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            50% { 
                transform: scale(1.2) rotate(-90deg);
                opacity: 0.8;
            }
            100% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        @keyframes rainbow-gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes text-glow {
            0% { 
                text-shadow: 2px 2px 4px rgba(0,0,0,0.8), 0 0 10px rgba(255,255,255,0.5);
            }
            100% { 
                text-shadow: 2px 2px 4px rgba(0,0,0,0.8), 0 0 20px rgba(255,255,255,0.8);
            }
        }

        /* ç²’å­æ•ˆæœ */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: currentColor;
            border-radius: 50%;
            pointer-events: none;
            animation: particle-fall 1s ease-out forwards;
        }

        @keyframes particle-fall {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(50px) scale(0.5);
            }
        }

        /* å¼€åœºè§†é¢‘é®ç½© */
        .intro-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            transition: opacity 0.5s ease-out;
        }

        .intro-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .intro-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .intro-video::-webkit-media-controls {
            display: none !important;
        }

        .intro-video::-webkit-media-controls-panel {
            display: none !important;
        }

        /* æš‚åœé®ç½© */
        .pause-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 500;
        }

        .pause-menu {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .pause-menu h2 {
            margin-bottom: 20px;
            color: #333;
            font-family: 'Noto Sans SC', 'Source Han Sans', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            font-weight: 700;
            font-size: 14px;
            text-shadow: 2px 2px 0 #ccc;
        }

         .pause-buttons {
             display: flex;
             flex-direction: column;
             align-items: center;
             gap: 15px;
         }

         .pause-menu button {
             padding: 12px 24px;
             font-size: 12px;
             border: none;
             border-radius: 8px;
             cursor: pointer;
             transition: background 0.3s ease;
             font-family: 'Noto Sans SC', 'Source Han Sans', 'PingFang SC', 'Microsoft YaHei', sans-serif;
             font-weight: 700;
             font-weight: 700;
             text-shadow: 2px 2px 0 #2c3e50;
             min-width: 120px;
         }

        .resume-game-btn {
            background: #4CAF50;
            color: white;
        }

        .resume-game-btn:hover {
            background: #45a049;
        }

        .restart-game-btn {
            background: #ff9800;
            color: white;
        }

        .restart-game-btn:hover {
            background: #f57c00;
        }

    </style>
</head>
<body>
    <!-- å¼€åœºè§†é¢‘é®ç½© -->
    <div class="intro-overlay" id="intro-overlay">
        <video class="intro-video" id="intro-video" autoplay muted playsinline preload="auto" webkit-playsinline>
            <source src="anime0915.mp4" type="video/mp4">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
        </video>
    </div>

    <div class="game-container">
        <!-- å½©è™¹æ¡¥ -->
        <div class="rainbow-bridge" id="rainbow-bridge">
            <div class="rainbow-segment" data-color="red"></div>
            <div class="rainbow-segment" data-color="orange"></div>
            <div class="rainbow-segment" data-color="yellow"></div>
            <div class="rainbow-segment" data-color="green"></div>
            <div class="rainbow-segment" data-color="blue"></div>
            <div class="rainbow-segment" data-color="indigo"></div>
            <div class="rainbow-segment" data-color="violet"></div>
        </div>

        <!-- è§†é¢‘èƒŒæ™¯ -->
        <video class="video-background" autoplay muted loop playsinline preload="auto" 
               webkit-playsinline x5-video-player-type="h5" x5-video-player-fullscreen="true"
               x5-video-orientation="portraint" disablePictureInPicture>
            <source src="movie_background.mp4" type="video/mp4">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
        </video>
        
        <!-- é“å…·æŒ‰é’® -->
        <div class="powerup-container">
            <button class="powerup-btn powerup-disabled" id="powerup-btn" onclick="usePowerup()">
                <span id="powerup-text">é“å…· x0</span>
            </button>
        </div>

        <!-- å€’è®¡æ—¶ -->
        <div class="countdown-container">
            <div class="countdown-bg"></div>
            <div class="countdown-label">å€’è®¡æ—¶</div>
            <div class="countdown-display" id="countdown-display">60</div>
        </div>

         <!-- é‡å¼€æç¤º -->
         <div class="restart-hint" id="restart-hint">
             <span>è‹¥æ­¤å±€æ— è§£ï¼Œå¯ç‚¹æ­¤å¤„é‡å¼€ğŸ‘‰</span>
         </div>

         <!-- æš‚åœæŒ‰é’® -->
         <div class="pause-container">
             <button class="btn" id="pause-btn" onclick="togglePause()">
                 <span>æš‚åœ</span>
             </button>
         </div>


        <!-- ç“¶å­å®¹å™¨ -->
        <div class="bottles-container">
            <div class="bottle" data-bottle="0">
                <div class="bottle-content" id="content-0"></div>
            </div>
            <div class="bottle" data-bottle="1">
                <div class="bottle-content" id="content-1"></div>
            </div>
            <div class="bottle" data-bottle="2">
                <div class="bottle-content" id="content-2"></div>
            </div>
            <div class="bottle" data-bottle="3">
                <div class="bottle-content" id="content-3"></div>
            </div>
        </div>

        <!-- èƒœåˆ©æ¶ˆæ¯ -->
        <div class="victory-message" id="victory-message">
            <div>ğŸ‰ æ­å–œè¿‡å…³ï¼ğŸ‰</div>
            <button class="next-level-btn" onclick="nextLevel()">ä¸‹ä¸€å…³</button>
        </div>

        <!-- å¤±è´¥æ¶ˆæ¯ -->
        <div class="game-over-message" id="game-over-message">
            <div>â° æ—¶é—´åˆ°ï¼æ¸¸æˆå¤±è´¥ï¼â°</div>
            <button class="restart-btn" onclick="restartLevel()">é‡æ–°å¼€å§‹</button>
        </div>

         <!-- æš‚åœèœå• -->
         <div class="pause-overlay" id="pause-overlay">
             <div class="pause-menu">
                 <h2>æ¸¸æˆæš‚åœ</h2>
                 <div class="pause-buttons">
                     <button class="resume-game-btn" onclick="togglePause()">ç»§ç»­</button>
                     <button class="restart-game-btn" onclick="restartLevel()">é‡å¼€</button>
                 </div>
             </div>
         </div>

         <!-- å½©è™¹æ¡¥å®Œæˆæç¤º -->
         <div class="rainbow-complete-message" id="rainbow-complete-message">
             <h2>ğŸŒˆ æ­å–œæˆåŠŸä¿®å¤å½©è™¹æ¡¥ï¼ğŸŒˆ</h2>
             <p>è·å¾—å®è—-å¤©èµåœ£éœ²ï¼</p>
             <div class="magic-potion-container">
                 <img src="img_rainbow.png" alt="å¤©èµåœ£éœ²" class="magic-potion-img" id="magic-potion-img">
             </div>
             <button class="rainbow-complete-btn" onclick="endGame()">ç»“æŸæ¸¸æˆ</button>
         </div>
    </div>

    <!-- èƒŒæ™¯éŸ³ä¹ -->
    <audio id="background-music" loop>
        <source src="music_magical mysteries.mp3" type="audio/mpeg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
    </audio>

    <!-- å¼€åœºè§†é¢‘éŸ³æ•ˆ -->
    <audio id="intro-sound" preload="auto">
        <source src="Untitled.mp3" type="audio/mpeg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
    </audio>

    <script src="game.js"></script>
    <script>
        // é«˜çº§è§†é¢‘å¾ªç¯æ’­æ”¾ä¼˜åŒ–å’Œè¡¥å¸§æŠ€æœ¯
        document.addEventListener('DOMContentLoaded', function() {
            const video = document.querySelector('.video-background');
            if (video) {
                let isLooping = false;
                let lastTime = 0;
                let frameCount = 0;
                let lastFrameTime = 0;
                
                // è®¾ç½®è§†é¢‘å±æ€§ä¼˜åŒ–
                video.defaultPlaybackRate = 1.0;
                video.playbackRate = 1.0;
                video.volume = 0;
                video.muted = true;
                
                // é¢„åŠ è½½ä¼˜åŒ–
                video.addEventListener('loadstart', function() {
                    console.log('è§†é¢‘å¼€å§‹åŠ è½½');
                    this.load();
                });
                
                // è§†é¢‘å…ƒæ•°æ®åŠ è½½å®Œæˆ
                video.addEventListener('loadedmetadata', function() {
                    console.log('è§†é¢‘å…ƒæ•°æ®åŠ è½½å®Œæˆï¼Œæ—¶é•¿:', this.duration);
                    // è®¾ç½®æ’­æ”¾è´¨é‡
                    this.currentTime = 0;
                });
                
                // è§†é¢‘æ•°æ®åŠ è½½å®Œæˆ
                video.addEventListener('loadeddata', function() {
                    console.log('è§†é¢‘æ•°æ®åŠ è½½å®Œæˆ');
                    this.play().catch(e => {
                        console.log('è§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’');
                    });
                });
                
                // è§†é¢‘å¯ä»¥æ’­æ”¾
                video.addEventListener('canplay', function() {
                    console.log('è§†é¢‘å¯ä»¥æ’­æ”¾');
                    if (this.paused) {
                        this.play().catch(e => {
                            console.log('è§†é¢‘æ’­æ”¾å¤±è´¥');
                        });
                    }
                });
                
                // è§†é¢‘å¯ä»¥æµç•…æ’­æ”¾
                video.addEventListener('canplaythrough', function() {
                    console.log('è§†é¢‘å¯ä»¥æµç•…æ’­æ”¾');
                });
                
                // é«˜çº§å¾ªç¯æ’­æ”¾ä¼˜åŒ–
                video.addEventListener('timeupdate', function() {
                    const currentTime = this.currentTime;
                    const duration = this.duration;
                    
                    // å¸§ç‡ç›‘æ§
                    frameCount++;
                    const now = performance.now();
                    if (now - lastFrameTime >= 1000) {
                        console.log('è§†é¢‘å¸§ç‡:', frameCount, 'fps');
                        frameCount = 0;
                        lastFrameTime = now;
                    }
                    
                    // æ— ç¼å¾ªç¯æ£€æµ‹
                    if (duration > 0) {
                        const remainingTime = duration - currentTime;
                        
                        // å½“æ¥è¿‘ç»“æŸæ—¶ï¼Œæå‰å‡†å¤‡å¾ªç¯
                        if (remainingTime < 0.2 && !isLooping) {
                            isLooping = true;
                            console.log('å‡†å¤‡è§†é¢‘å¾ªç¯');
                            
                            // ä½¿ç”¨ requestAnimationFrame ç¡®ä¿å¹³æ»‘è¿‡æ¸¡
                            requestAnimationFrame(() => {
                                this.currentTime = 0;
                                isLooping = false;
                            });
                        }
                        
                        // é˜²æ­¢è§†é¢‘å¡åœ¨æœ€åä¸€å¸§
                        if (remainingTime < 0.05) {
                            this.currentTime = 0;
                        }
                    }
                });
                
                // è§†é¢‘æ’­æ”¾ç»“æŸäº‹ä»¶
                video.addEventListener('ended', function() {
                    console.log('è§†é¢‘æ’­æ”¾ç»“æŸï¼Œé‡æ–°å¼€å§‹');
                    this.currentTime = 0;
                    this.play().catch(e => {
                        console.log('è§†é¢‘é‡æ–°æ’­æ”¾å¤±è´¥');
                    });
                });
                
                // è§†é¢‘æš‚åœæ—¶è‡ªåŠ¨æ¢å¤
                video.addEventListener('pause', function() {
                    console.log('è§†é¢‘æš‚åœï¼Œå°è¯•æ¢å¤æ’­æ”¾');
                    setTimeout(() => {
                        if (this.paused) {
                            this.play().catch(e => {
                                console.log('è§†é¢‘æ¢å¤æ’­æ”¾å¤±è´¥');
                            });
                        }
                    }, 100);
                });
                
                // è§†é¢‘é”™è¯¯å¤„ç†
                video.addEventListener('error', function(e) {
                    console.error('è§†é¢‘æ’­æ”¾é”™è¯¯:', e);
                    console.error('é”™è¯¯è¯¦æƒ…:', this.error);
                });
                
                // è§†é¢‘ç­‰å¾…æ•°æ®
                video.addEventListener('waiting', function() {
                    console.log('è§†é¢‘ç­‰å¾…æ•°æ®...');
                });
                
                // è§†é¢‘å¼€å§‹æ’­æ”¾
                video.addEventListener('play', function() {
                    console.log('è§†é¢‘å¼€å§‹æ’­æ”¾');
                });
                
                // é¡µé¢å¯è§æ€§å˜åŒ–æ—¶ä¿æŒæ’­æ”¾
                document.addEventListener('visibilitychange', function() {
                    if (!document.hidden && video.paused) {
                        video.play().catch(e => {
                            console.log('é¡µé¢é‡æ–°å¯è§æ—¶è§†é¢‘æ’­æ”¾å¤±è´¥');
                        });
                    }
                });
                
                // çª—å£å¤±å»ç„¦ç‚¹æ—¶æš‚åœï¼Œè·å¾—ç„¦ç‚¹æ—¶æ¢å¤
                window.addEventListener('blur', function() {
                    if (!video.paused) {
                        video.pause();
                    }
                });
                
                window.addEventListener('focus', function() {
                    if (video.paused) {
                        video.play().catch(e => {
                            console.log('çª—å£è·å¾—ç„¦ç‚¹æ—¶è§†é¢‘æ’­æ”¾å¤±è´¥');
                        });
                    }
                });
            }
        });
    </script>
</body>
</html>
